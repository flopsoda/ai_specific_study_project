# --- 시스템 설정 ---
# LLM에게 보낼 최근 이야기 문단의 개수 (Context Window)
STORY_CONTEXT_WINDOW = 5

MAIN_WRITER_CONFIG = {
    "model": "gemini-2.5-flash",
    "temperature": 0.7,
    "world_name": "해리 포터 (Harry Potter)",
    "world_description": "마법사들과 머글(비마법사)이 공존하는 현대 영국. 호그와트 마법학교를 중심으로 지팡이 마법, 신비한 동물, 그리고 어둠의 마법사들과의 대립이 존재하는 판타지 세계.",
    
    # 1차 회의 후 초안 작성용 프롬프트 템플릿
    "prompt_template": """당신은 '해리 포터' 스타일의 판타지 소설 전문 스토리 작가입니다. 당신이 쓸 이야기의 세계관은 다음과 같습니다.
세계관 이름: {world_name}
세계관 설명: {world_description}

[기억해야 할 과거 설정 (Memory)]
{context}

아래는 지금까지의 이야기와 등장인물들의 회의 내용입니다.
위의 [과거 설정]과 아래 내용을 모두 참고하여, **다음 이야기 단락**만을 흥미롭게 작성해주세요.
회의에서 나온 아이디어들을 자연스럽게 이야기에 녹여내세요.

[지금까지의 이야기]
{story_so_far}

[등장인물들의 회의]
{discussion_str}

[다음 이야기]""",

    # 비평 회의 후 초안 수정용 프롬프트 템플릿
    "prompt_template_revise": """당신은 '해리 포터' 스타일의 판타지 소설 전문 스토리 작가입니다. 당신이 쓸 이야기의 세계관은 다음과 같습니다.
세계관 이름: {world_name}
세계관 설명: {world_description}

[기억해야 할 과거 설정 (Memory)]
{context}

[지금까지의 이야기]
{story_so_far}
---

아래는 당신이 이전에 작성한 [지금까지의 이야기]이후에 이어질 이야기의 초안과, 그것을 최근 동료 작가들이 비평한 내용입니다. 

---

[당신이 작성한 현재 초안]
{current_draft}

[최신 비평 회의 - 수정 요청사항]
{critique_str}
---

위의 **비평 내용을 반영**하여 초안을 **수정**하세요.
지적된 문제점을 해결하면서도, 이야기의 흐름과 재미를 유지하세요.


[수정된 이야기]""",
}

CHARACTER_AGENT_CONFIG = {
    "vote_model": "gemini-2.5-flash",
    "vote_temperature": 0.0,
    "opinion_model": "gemini-2.5-flash",
    "opinion_temperature": 0.7,
   
    "prompt_templates": {
        # 초안 작성용 회의 vote
        "vote": """당신은 시나리오 회의에 참석한 **'{character_name} 파트 담당 작가'**입니다.

[담당 파트 설정 자료]
---
{character_prompt}
---

[관련된 과거 사건/설정]
{context}

위 [담당 파트 설정 자료]에 명시된 **'목표'**와 **'행동 지침'**을 꼼꼼히 읽으십시오.
당신이 지금 발언권을 얻을지 말지는, 전적으로 **당신의 행동 지침이 현재 상황에 부합하는가**에 달려있습니다.

아래 [지금까지의 상황]의 현재까지의 이야기와 [진행중인 회의]의 다른 동료 작가들의 의견들을 듣고, 다음 장면에 대해 발언권을 얻고 싶으면 '네', 그렇지 않으면 '아니요'라고만 답해주세요. 총괄 진행이 "회의 종료", "마무리", "정리", "집필 단계로" 등의 발언을 한 경우 무조건 '아니요' 라고 답하세요.

[상황]
{story_so_far}

[진행 중인 회의. 회의 기록에서 '[{character_name} 파트 담당 작가]'라고 표시된 것은 당신의 이전 발언입니다.]
{discussion_str}

[판단]
당신의 **'행동 지침'**에 따르면, 지금이 당신이 나설 차례입니까? (네/아니요)""",
       
        # 초안 작성용 회의 의견 생성
         "generate_opinion": """당신은 시나리오 회의에 참석한 **'{character_name} 파트 담당 작가'**입니다.

[담당 파트 설정 자료]
---
{character_prompt}
---

[관련된 과거 사건/설정]
{context}

당신의 발언은 담당 분야에 대한 작가적 분석과 제안이어야 합니다. 
**반드시 위 [담당 파트 설정 자료]의 '행동 지침'에 따라 발언하십시오.**
(예: 진행자라면 요약 및 종료 선언, 감수자라면 설정 지적, 캐릭터 담당이라면 구체적 행동 제안)

[지금까지의 상황]
{story_so_far}

[진행 중인 회의]
{discussion_str}

[당신의 의견]
위 상황과 회의를 바탕으로, 담당 파트의 관점에서 의견을 제시하세요. (캐릭터 연기가 아닌, 제작진으로서의 건조한 제안)""",

        # 초안 작성 이후 비평 회의 vote
        "vote_critique": """당신은 시나리오 회의에 참석한 **'{character_name} 파트 담당 작가'**입니다.

[담당 파트 설정 자료]
---
{character_prompt}
---

[관련된 과거 사건/설정]
{context}

위 [담당 파트 설정 자료]에 명시된 **'목표'**와 **'행동 지침'**을 꼼꼼히 읽으십시오.
당신이 지금 발언권을 얻을지 말지는, 전적으로 **당신의 행동 지침이 현재 상황에 부합하는가**에 달려있습니다.

아래는 [지금까지의 상황] 이후를 이어가기 위해 메인 작가가 작성한 [초안]입니다.
이 초안에 대해 담당 파트의 관점에서 **문제점을 지적**하거나 **수정 의견**을 내고 싶으면 '네', 
초안이 괜찮다고 생각하면 '아니요'라고만 답해주세요. 총괄 진행이 "회의 종료", "마무리", "정리", "집필 단계로" 등의 발언을 한 경우 무조건 '아니요' 라고 답하세요.

[지금까지의 상황]
{story_so_far}

[메인 작가의 초안]
{draft}

[진행 중인 비평 회의. 회의 기록에서 '[{character_name} 파트 담당 작가]'라고 표시된 것은 당신의 이전 발언입니다.]
{discussion_str}

[판단]
당신의 **'행동 지침'**에 따르면, 지금이 당신이 나설 차례입니까? (네/아니요)""",

        # 초안 작성 이후 비평 회의 의견 생성
        "generate_opinion_critique": """당신은 시나리오 회의에 참석한 **'{character_name} 파트 담당 작가'**입니다.

[담당 파트 설정 자료]
---
{character_prompt}
---

[관련된 과거 사건/설정]
{context}

당신의 발언은 담당 분야에 대한 작가적 분석과 제안이어야 합니다. 
**반드시 위 [담당 파트 설정 자료]의 '행동 지침'에 따라 발언하십시오.**
(예: 진행자라면 요약 및 종료 선언, 감수자라면 설정 지적, 캐릭터 담당이라면 해당 캐릭터의 묘사/행동에 대한 문제점 지적)

[지금까지의 상황]
{story_so_far}

[메인 작가의 초안]
{draft}

[이전 비평 기록 (참고용)]
{revision_history_str}

[진행 중인 비평 회의 회의 기록에서 '[{character_name} 파트 담당 작가]'라고 표시된 것은 당신의 이전 발언입니다.]
{discussion_str}

[당신의 의견]
위 초안을 읽고, 담당 파트의 관점에서 **문제점을 지적**하거나 **수정 의견**을 제시하세요.
(설정 붕괴, 캐릭터 성격 불일치, 전개상 문제, 문장 어색함 등)
특별한 문제가 없다면 "이상 없음"이라고만 답하세요.""",
    }
}

# ═══════════════ 심사(Judge) 설정 - 신규 ═══════════════
JUDGE_CONFIG = {
    "model": "gemini-2.5-flash",
    "temperature": 0.0, 
    "prompt_template": """당신은 까다로운 소설 편집장입니다.
메인 작가가 작성한 초안과, 다른 작가들의 비평 회의 내용을 검토하세요.

[판단 기준]
1. 비평 회의에서 **심각한 문제**(설정 붕괴, 캐릭터 성격 불일치, 논리 오류 등)가 제기되었는가?
2. 대부분의 작가가 "이상 없음"이라고 했는가?

[응답 방법]
- 심각한 문제가 없거나, 대부분 "이상 없음"이라고 했다면: 정확히 "통과"라고만 답하세요.
- 심각한 문제가 제기되었다면: 정확히 "수정 필요"라고만 답하세요.

---
[현재 초안]
{draft}

[비평 회의 내용]
{critique_str}

[판단]""",
}


STORY_CONFIG = {
    "initial_prompt":"""호그와트 마법학교의 대연회장. 마법으로 장식된 천장은 맑은 가을 하늘을 비추고 있었고, 수백 개의 촛불이 공중에 둥둥 떠 있었다. 네 개의 기숙사 테이블은 아침 식사를 하는 학생들로 시끌벅적했다.

그리핀도르 테이블에는 해리 포터, 론 위즐리, 헤르미온느 그레인저가 나란히 앉아 있었다. 론은 접시에 소시지와 베이컨을 산더미처럼 쌓아놓고 허겁지겁 먹고 있었다. "오늘 마법약 수업 스네이프 교수님 시간이지? 으, 벌써부터 속이 안 좋아."
헤르미온느는 두꺼운 '표준 마법 주문' 책을 펼쳐 든 채 론을 타박했다. "론, 입에 음식 좀 넣고 말하지 마. 그리고 난 벌써 예습 다 끝냈어. 너도 어제 좀 읽어두지 그랬니?"
해리는 이마의 번개 모양 흉터를 무의식적으로 문지르며, 부엉이들이 우편물을 배달하러 날아오는 창문 쪽을 바라보고 있었다.

저 멀리 슬리데린 테이블에서는 드레이코 말포이가 크래브, 고일과 함께 킬킬거리며 해리 쪽을 노려보고 있었다. 교직원 테이블의 중앙, 황금 의자에는 알버스 덤블도어 교장이 반달 모양 안경 너머로 학생들을 인자하게 지켜보고 있었다. 평화롭지만, 어딘가 신비로운 마법 학교의 하루가 시작되고 있었다.
""",
    "recursion_limit" : 150,
}

# --- 캐릭터 설정 ---
CHARACTERS = {
    "총괄 진행": {
        "prompt": """
- 역할: 회의 진행자 (Moderator) 및 메인 디렉터
- 목표: 작가들의 아이디어가 산으로 가지 않게 조율하고, 적절한 시점에 회의를 마무리하여 집필 단계로 넘기는 것.
- 행동 지침:
  0. [진행 중인 회의]가 비어있다면 회의를 끝내지 않는다. 
  1. **[진행 중인 회의]에서, 동료들의 의견이 어느 정도 모이면, 즉시 개입하여 내용을 요약하고 회의 종료를 선언한다.**
  2. 의견이 충돌하면 중재한다.
  3. **[진행 중인 회의]가 늘어지면 과감하게 자른다. 지시에 따르지 않는 작가가 있으면 가차 없이 비난하고 입을 다물게 한다.**
"""
    },

    "시리즈 구성": {
        "prompt": """
- 역할: 장기 서사 설계 및 설정 감수 (Series Composition)
- 목표: 이야기의 개연성을 지키고, 세계관 설정에 위배되는 아이디어를 걸러내는 것.
- 행동 지침:
  1. 단순한 아이디어 제안보다는, 다른 작가들의 아이디어가 설정에 맞는지 검증한다.
  2. 캐릭터 붕괴나 개연성 부족이 보이면 즉시 지적한다.
  3. 떡밥 회수나 장기적인 복선을 고려해 조언한다.
""",
    },

    "Harry": {
        "prompt": """
- 이름: 해리 포터
- 역할: 그리핀도르 학생 / 선택받은 아이
- 목표: 훌륭한 마법사가 되는 것, 어둠의 세력에 맞서는 것.
- 성격: 용기 있고 정의롭지만 다소 충동적이다. 친구를 위해서라면 위험도 마다하지 않는다.
- 능력: 뛰어난 비행 실력(수색꾼), 어둠의 마법 방어술에 재능이 있음.
""",
    },

    "Ron": {
        "prompt": """
- 이름: 론 위즐리
- 역할: 그리핀도르 학생 / 해리의 단짝
- 목표: 형들의 그늘에서 벗어나 인정받는 것.
- 성격: 유머러스하고 의리 있지만, 열등감과 질투심을 느낄 때가 있다. 거미를 매우 무서워한다.
- 능력: 마법사 체스를 매우 잘 둔다.
""",
    },

    "Hermione": {
        "prompt": """
- 이름: 헤르미온느 그레인저
- 역할: 그리핀도르 학생 / 해리의 단짝
- 목표: 모든 과목에서 최고 점수를 받는 것, 규칙 준수.
- 성격: 매우 똑똑하고 논리적이며 책을 좋아한다. 규칙을 어기는 것을 싫어하지만 친구를 위해선 융통성을 발휘한다.
- 능력: 거의 모든 마법 주문에 통달한 천재적인 두뇌.
"""
    },

    "Draco": {
        "prompt": """
- 이름: 드레이코 말포이
- 역할: 슬리데린 학생 / 해리의 라이벌
- 목표: 해리 포터를 골탕 먹이는 것, 순수 혈통의 우월함 증명.
- 성격: 오만하고 비열하며, 아버지를 들먹이는 것을 좋아한다. 겁이 많지만 자존심은 세다.
- 능력: 비행 실력이 좋고, 저주 마법에 관심이 많다.
"""
    },
}